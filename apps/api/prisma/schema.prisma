generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  profile      UserProfile?
  friends      Friend[] @relation("UserFriends")
  friendOf     Friend[] @relation("FriendOf")
  requestsFrom FriendRequest[] @relation("FromUser")
  requestsTo   FriendRequest[] @relation("ToUser")
  userGames    UserGame[]
  activity     Activity[]
  notifications Notification[]
  settings     Settings?
  apiTokens    ApiToken?
}

model UserProfile {
  userId       String  @id
  user         User    @relation(fields: [userId], references: [id])
  displayName  String
  avatarUrl    String?
  bio          String?
  favoriteGames String @default("[]")
  visibility   String @default("PUBLIC")
}

model Friend {
  id       String   @id @default(cuid())
  user     User     @relation("UserFriends", fields: [userId], references: [id])
  userId   String
  friend   User     @relation("FriendOf", fields: [friendId], references: [id])
  friendId String
  since    DateTime @default(now())
}

model FriendRequest {
  id        String   @id @default(cuid())
  fromUser  User     @relation("FromUser", fields: [fromUserId], references: [id])
  fromUserId String
  toUser    User     @relation("ToUser", fields: [toUserId], references: [id])
  toUserId  String
  status    String @default("PENDING")
  createdAt DateTime @default(now())
}

model Game {
  id           String   @id
  name         String
  steamAppId   Int?
  igdbId       Int?
  coverUrl     String?
  genres       String @default("[]")
  tags         String @default("[]")
  summary      String?
  rating       Float?
  releaseDate  DateTime?
  screenshots  String @default("[]")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userGames    UserGame[]
  similarityCache GameSimilarityCache[]
  similarTo    GameSimilarityCache[] @relation("GameSimilarity")
}

model UserGame {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  game      Game     @relation(fields: [gameId], references: [id])
  gameId    String
  hours     Float    @default(0)
  lastPlayed DateTime?
  playtimeByMonth String @default("{}")
  createdAt DateTime @default(now())

  @@unique([userId, gameId])
}

model GameSimilarityCache {
  id        String   @id @default(cuid())
  game      Game     @relation(fields: [gameId], references: [id])
  gameId    String
  similarTo Game     @relation("GameSimilarity", fields: [similarToId], references: [id])
  similarToId String
  score     Float
  reasons   String @default("[]")
  createdAt DateTime @default(now())
}

model Activity {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  type      String
  description String
  metadata  String @default("{}")
  createdAt DateTime @default(now())
}

model Notification {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  type      String
  payload   String @default("{}")
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model ApiCache {
  id        String   @id @default(cuid())
  key       String   @unique
  payload   String
  source    String
  fetchedAt DateTime @default(now())
  expiresAt DateTime
}

model Settings {
  id                 String   @id @default(cuid())
  user               User     @relation(fields: [userId], references: [id])
  userId             String   @unique
  profileVisibility  String @default("PUBLIC")
  notifyActivity     Boolean  @default(true)
  weeklySummary      Boolean  @default(false)
}

model ApiToken {\n  id        String   @id @default(cuid())\n  user      User     @relation(fields: [userId], references: [id])\n  userId    String   @unique\n  steamId   String?  @unique // Index for fast lookups when user logs in via OpenID\n  steamKey  String?  // Deprecated: DO NOT use per-user API keys\n  igdbClientId String?\n  igdbClientSecret String?\n  createdAt DateTime @default(now())\n}
